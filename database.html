<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>ISS Database Viewer</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'Inter',sans-serif;background:#1a1a2e;color:#e5e7eb;min-height:100vh;position:relative;overflow-x:hidden;}
body::before{content:'';position:fixed;width:100%;height:100%;top:0;left:0;z-index:-1;background:
radial-gradient(ellipse at 10% 20%, rgba(99,102,241,0.2) 0%, transparent 40%),
radial-gradient(ellipse at 90% 70%, rgba(168,85,247,0.18) 0%, transparent 40%),
radial-gradient(ellipse at 50% 50%, rgba(59,130,246,0.12) 0%, transparent 50%);}
header{background: rgba(25,29,56,0.85);backdrop-filter: blur(20px);border-bottom:1px solid rgba(255,255,255,0.06);padding:24px 48px;display:flex;justify-content:space-between;align-items:center;position:sticky;top:0;z-index:1000;}
.logo{display:flex;align-items:center;gap:16px;}
.logo-icon{width:48px;height:48px;background:linear-gradient(135deg,#6366f1 0%,#a855f7 100%);border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:24px;box-shadow:0 8px 32px rgba(99,102,241,0.3);}
.logo-text h1{font-size:24px;font-weight:700;letter-spacing:-0.5px;background:linear-gradient(135deg,#6366f1,#a855f7);-webkit-background-clip:text;-webkit-text-fill-color:transparent;}
.logo-text p{font-size:13px;color:rgba(229,231,235,0.6);font-weight:400;margin-top:2px;}
.back-button{background:linear-gradient(135deg,#6366f1,#8b5cf6);border:none;color:white;padding:12px 24px;border-radius:12px;font-weight:600;cursor:pointer;font-size:14px;transition:all 0.3s cubic-bezier(0.4,0,0.2,1);text-decoration:none;display:flex;align-items:center;gap:8px;box-shadow:0 4px 16px rgba(99,102,241,0.3);}
.back-button:hover{transform:translateY(-2px);box-shadow:0 8px 24px rgba(99,102,241,0.4);}
.container{max-width:1400px;margin:48px auto;padding:0 48px;}
.stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:24px;margin-bottom:32px;}
.stat-card{background:rgba(25,29,56,0.65);backdrop-filter:blur(20px);border:1px solid rgba(255,255,255,0.08);padding:28px;border-radius:16px;transition:all 0.3s cubic-bezier(0.4,0,0.2,1);}
.stat-card:hover{transform:translateY(-4px);border-color:rgba(99,102,241,0.3);box-shadow:0 12px 32px rgba(99,102,241,0.15);}
.stat-label{font-size:13px;font-weight:600;text-transform:uppercase;letter-spacing:1.2px;color:rgba(229,231,235,0.6);margin-bottom:8px;}
.stat-value{font-size:32px;font-weight:700;background:linear-gradient(135deg,#6366f1,#a855f7);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}
.table-container{background:rgba(25,29,56,0.65);backdrop-filter:blur(20px);border:1px solid rgba(255,255,255,0.08);border-radius:16px;overflow:hidden;box-shadow:0 8px 32px rgba(0,0,0,0.3);margin-bottom:32px;}
table{width:100%;border-collapse:collapse;}
thead{background:rgba(99,102,241,0.1);border-bottom:2px solid rgba(99,102,241,0.3);}
th{padding:20px 24px;text-align:left;font-size:12px;font-weight:700;text-transform:uppercase;letter-spacing:1.2px;color:rgba(229,231,235,0.8);}
tbody tr{border-bottom:1px solid rgba(255,255,255,0.04);transition:all 0.2s ease;}
tbody tr:hover{background:rgba(99,102,241,0.08);}
td{padding:18px 24px;font-size:14px;color:rgba(229,231,235,0.9);}
.id-col{color:#6366f1;font-weight:700;font-size:13px;}
.coord-col{font-family:'Monaco',monospace;color:#fbbf24;font-weight:500;}
.alt-col{color:#10b981;font-weight:700;}
.time-col{color:rgba(229,231,235,0.6);font-size:13px;font-family:'Monaco',monospace;}
.loading,.no-data{text-align:center;padding:64px 32px;color:rgba(229,231,235,0.5);font-size:15px;}
.download-button{background:linear-gradient(135deg,#10b981,#059669);border:none;color:white;padding:18px 36px;border-radius:12px;font-weight:700;cursor:pointer;font-size:16px;transition:all 0.3s;display:inline-flex;align-items:center;gap:12px;margin-top:16px;box-shadow:0 4px 16px rgba(16,185,129,0.3);}
.download-button:hover{transform:translateY(-2px);box-shadow:0 8px 32px rgba(16,185,129,0.4);}
.current-day{font-size:18px;font-weight:700;color:#6366f1;margin:16px 0;}
</style>
</head>
<body>
<header>
  <div class="logo">
    <div class="logo-icon"></div>
    <div class="logo-text">
      <h1>Database Viewer</h1>
      <p>ISS Position Records Archive</p>
    </div>
  </div>
  <a href="/" class="back-button">← Back to Dashboard</a>
</header>

<div class="container">
  <div class="stats-grid">
    <div class="stat-card"><div class="stat-label">Total Records</div><div class="stat-value" id="totalRecords">0</div></div>
    <div class="stat-card"><div class="stat-label">Total Days</div><div class="stat-value" id="totalDays">0</div></div>
  </div>

  <div id="allTables"></div>
</div>

<script>
let records = [];
let days = [];

async function fetchAllData(){
  try {
    const res = await fetch('/api/preview');
    const data = await res.json();
    const newRecords = data.records || [];
    if(newRecords.length===0){
      document.getElementById('allTables').innerHTML='<div class="no-data">No data available</div>';
      document.getElementById('totalRecords').innerText='0';
      document.getElementById('totalDays').innerText='0';
      records=[]; days=[];
      return;
    }
    records = newRecords.map(r=>{
      const day=r.ts_myt.split(' ')[0];
      return {...r, day};
    });
    const daySet = new Set(records.map(r=>r.day));
    days = Array.from(daySet).sort();
    updateSummary();
    renderTables();
  } catch(err){
    console.error('Failed to fetch data:', err);
  }
}

function updateSummary(){
  document.getElementById('totalRecords').innerText = records.length.toLocaleString();
  document.getElementById('totalDays').innerText = days.length;
}

function renderTables(){
  const container = document.getElementById('allTables');
  container.innerHTML='';
  days.forEach((day,idx)=>{
    const dayRecords = records.filter(r=>r.day===day);
    const tableHTML=`
    <div class="table-container">
      <div class="current-day">Day ${idx+1} — ${day}</div>
      <table>
        <thead><tr>
          <th>ID</th><th>Latitude (°)</th><th>Longitude (°)</th><th>Altitude (km)</th><th>Timestamp (UTC)</th>
        </tr></thead>
        <tbody>
          ${dayRecords.length===0?`<tr><td colspan="5" class="no-data">No records for this day</td></tr>`:
          dayRecords.map((r,i)=>`<tr>
            <td class="id-col">#${i+1}</td>
            <td class="coord-col">${r.latitude.toFixed(4)}</td>
            <td class="coord-col">${r.longitude.toFixed(4)}</td>
            <td class="alt-col">${r.altitude?r.altitude.toFixed(2):'N/A'}</td>
            <td class="time-col">${r.ts_myt}</td>
          </tr>`).join('')}
        </tbody>
      </table>
      <button class="download-button" onclick="downloadDayCSV('${day}')">Download CSV (${day})</button>
    </div>`;
    container.insertAdjacentHTML('beforeend', tableHTML);
  });
}

function downloadDayCSV(day){
  window.location.href=`/api/download?day=${day}`;
}

// Initial fetch & auto-refresh
fetchAllData();
setInterval(fetchAllData,30000);
</script>
</body>
</html>
