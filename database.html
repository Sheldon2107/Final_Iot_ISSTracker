<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>ISS Database Viewer</title>
<style>
body {font-family: Arial, sans-serif; background:#0a0e27; color:#e8eaf6; margin:0; padding:20px;}
h1 {text-align:center; margin-bottom:20px;}
.button {background:#667eea;color:white;padding:10px 15px;border:none;border-radius:6px;cursor:pointer;margin-right:5px;}
.button:disabled {background:gray; cursor:not-allowed;}
#stats {margin-bottom:15px;}
table {width:100%; border-collapse:collapse;}
th, td {border:1px solid rgba(255,255,255,0.2); padding:8px; text-align:center;}
th {background:rgba(102,126,234,0.2);}
</style>
</head>
<body>

<h1>üõ∞Ô∏è ISS Database Viewer</h1>

<div id="controls">
    <button class="button" id="prevDay">‚Üê Previous Day</button>
    <span id="currentDay">Day 1</span>
    <button class="button" id="nextDay">Next Day ‚Üí</button>
    <button class="button" id="downloadDay">üíæ Download Day CSV</button>
</div>

<div id="stats">
    Total Records: <span id="totalRecords">0</span> |
    Total Days: <span id="totalDays">0</span>
</div>

<table id="dataTable">
    <thead>
        <tr>
            <th>ID</th>
            <th>Latitude (¬∞)</th>
            <th>Longitude (¬∞)</th>
            <th>Altitude (km)</th>
            <th>Velocity (km/h)</th>
            <th>Timestamp (MYT)</th>
        </tr>
    </thead>
    <tbody>
        <tr><td colspan="6">Loading data...</td></tr>
    </tbody>
</table>

<script>
let dayIndex = 0;
let availableDays = [];

async function fetchDays() {
    const res = await fetch('/api/all-records');
    const json = await res.json();
    availableDays = json.available_days || [];
    document.getElementById('totalDays').innerText = availableDays.length;
    updateTable();
}

async function updateTable() {
    if (!availableDays.length) return;
    const day = availableDays[dayIndex];
    document.getElementById('currentDay').innerText = `Day ${dayIndex+1} (${day})`;
    
    const res = await fetch(`/api/preview?day_index=${dayIndex}`);
    const json = await res.json();
    const records = json.records || [];

    document.getElementById('totalRecords').innerText = records.length;

    const tbody = document.getElementById('dataTable').querySelector('tbody');
    tbody.innerHTML = '';
    if (!records.length) {
        tbody.innerHTML = `<tr><td colspan="6">No records for this day</td></tr>`;
        return;
    }

    records.forEach((r,i)=>{
        const row = document.createElement('tr');
        row.innerHTML = `
            <td>${i+1}</td>
            <td>${r.latitude?.toFixed(4) || '--'}</td>
            <td>${r.longitude?.toFixed(4) || '--'}</td>
            <td>${r.altitude?.toFixed(2) || '--'}</td>
            <td>${r.velocity?.toFixed(2) || '--'}</td>
            <td>${r.ts_myt || '--'}</td>
        `;
        tbody.appendChild(row);
    });
}

// Buttons
document.getElementById('prevDay').onclick = ()=>{
    if(dayIndex>0){ dayIndex--; updateTable(); }
};
document.getElementById('nextDay').onclick = ()=>{
    if(dayIndex<availableDays.length-1){ dayIndex++; updateTable(); }
};
document.getElementById('downloadDay').onclick = ()=>{
    if(!availableDays.length) return;
    const day = availableDays[dayIndex];
    window.location.href = `/api/download?day=${day}`;
};

// Initialize
fetchDays();
</script>

</body>
</html>
