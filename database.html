<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>ISS Database Viewer - 3 Days Preview</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap');
* {margin:0;padding:0;box-sizing:border-box;}
body {font-family:'Space Grotesk',sans-serif;background:#0a0e27;color:#e8eaf6;min-height:100vh;position:relative;}
body::before {content:'';position:fixed;width:200%;height:200%;top:-50%;left:-50%;z-index:-1;background: radial-gradient(circle at 20% 50%, rgba(120, 119, 198, 0.3), transparent 50%), radial-gradient(circle at 80% 80%, rgba(33, 150, 243, 0.3), transparent 50%); animation: drift 20s ease-in-out infinite;}
@keyframes drift {0%,100%{transform:translate(0,0);}50%{transform:translate(30px,-30px);}}

.container {max-width:1400px;margin:0 auto;padding:40px 20px;}
header {background: rgba(10, 14, 39, 0.8);backdrop-filter: blur(20px);border-bottom:1px solid rgba(255,255,255,0.08);padding:20px 40px;margin-bottom:40px;display:flex;justify-content:space-between;align-items:center;}
.back-btn {background:linear-gradient(135deg,#667eea,#764ba2);border:none;color:white;padding:12px 24px;border-radius:8px;font-weight:600;cursor:pointer;font-size:14px;transition:all 0.3s;text-decoration:none;display:inline-block;}
.back-btn:hover {transform:translateY(-2px);box-shadow:0 5px 20px rgba(102,126,234,0.4);}
.title {font-size:28px;font-weight:700;background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;}

.stats {display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:20px;margin-bottom:15px;}
.stat-box {background: linear-gradient(135deg, rgba(102,126,234,0.1), rgba(118,75,162,0.1));border:1px solid rgba(102,126,234,0.2);border-radius:16px;padding:20px;text-align:center;}
.stat-label {font-size:12px;text-transform:uppercase;letter-spacing:1px;color:rgba(232,234,246,0.6);margin-bottom:10px;}
.stat-value {font-size:32px;font-weight:700;background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;}

.table-container {background: rgba(10, 14, 39, 0.6);backdrop-filter:blur(20px);border:1px solid rgba(255,255,255,0.08);border-radius:16px;overflow:hidden;margin-bottom:30px;}

table {width:100%;border-collapse:collapse;}
thead {background:linear-gradient(135deg, rgba(102,126,234,0.15), rgba(118,75,162,0.15));position:sticky;top:0;z-index:10;}
th {padding:16px 12px;font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:1px;color:rgba(232,234,246,0.8);text-align:left;border-bottom:2px solid rgba(102,126,234,0.3);}
td {padding:14px 12px;font-size:13px;color:rgba(232,234,246,0.8);border-bottom:1px solid rgba(255,255,255,0.05);font-weight:500;}
tbody tr {transition:background 0.2s ease;}
tbody tr:hover {background: rgba(102,126,234,0.08);}

.day-badge {background: rgba(16,185,129,0.15);border:1px solid rgba(16,185,129,0.3);padding:4px 10px;border-radius:8px;font-weight:600;color:#10b981;display:inline-block;font-size:11px;}
.loading {text-align:center;padding:60px;font-size:18px;color:rgba(232,234,246,0.6);}

.day-navigation {display:flex;justify-content:space-between;align-items:center;margin-bottom:15px;}
.day-navigation button {background:rgba(102,126,234,0.2);border:1px solid rgba(102,126,234,0.4);color:#667eea;padding:8px 16px;border-radius:8px;cursor:pointer;font-weight:600;font-size:12px;}
.day-navigation button:disabled {opacity:0.5;cursor:not-allowed;}
.day-navigation div {font-size:13px;font-weight:600;color:rgba(232,234,246,0.8);}
</style>
</head>
<body>
<header>
  <h1 class="title">üìä ISS Database Viewer</h1>
  <a href="/" class="back-btn">‚Üê Back to Dashboard</a>
</header>

<div class="container">
  <div class="stats">
    <div class="stat-box">
      <div class="stat-label">Total Records</div>
      <div class="stat-value" id="totalRecords">--</div>
    </div>
    <div class="stat-box">
      <div class="stat-label">Current Page</div>
      <div class="stat-value" id="currentPage">--</div>
    </div>
    <div class="stat-box">
      <div class="stat-label">Total Pages</div>
      <div class="stat-value">3</div>
    </div>
    <div class="stat-box">
      <div class="stat-label">Records/Page</div>
      <div class="stat-value">500</div>
    </div>
  </div>

  <div class="day-navigation">
    <button id="prevDay">‚Üê Previous</button>
    <div>Day <span id="currentDay">1</span> of 3</div>
    <button id="nextDay">Next ‚Üí</button>
  </div>

  <div class="table-container">
    <table>
      <thead>
        <tr>
          <th>Record ID</th>
          <th>Timestamp (UTC)</th>
          <th>Day</th>
          <th>Latitude</th>
          <th>Longitude</th>
          <th>Altitude (km)</th>
        </tr>
      </thead>
      <tbody id="tableBody">
        <tr><td colspan="6" class="loading">Loading data...</td></tr>
      </tbody>
    </table>
  </div>
</div>

<script>
let currentDay = 1;
const totalDays = 3;
const perPage = 500;

// Compute date string from day index (1 = oldest, 3 = newest)
function getDayString(dayIndex) {
  const d = new Date();
  d.setDate(d.getDate() - (totalDays - dayIndex));
  return d.toISOString().split('T')[0]; // YYYY-MM-DD
}

async function fetchDataForDay(dayIndex) {
  const dayStr = getDayString(dayIndex);
  try {
    const params = new URLSearchParams({ day: dayStr });
    const res = await fetch(`/api/all-records?${params}`);
    const data = await res.json();

    document.getElementById('totalRecords').textContent = data.total.toLocaleString();
    document.getElementById('currentPage').textContent = dayIndex;
    document.getElementById('currentDay').textContent = dayIndex;

    const tbody = document.getElementById('tableBody');
    tbody.innerHTML = '';

    if (!data.records || data.records.length === 0) {
      tbody.innerHTML = '<tr><td colspan="6" class="loading">No records found</td></tr>';
      return;
    }

    data.records.forEach(record => {
      const row = document.createElement('tr');
      row.innerHTML = `
        <td>#${record.id}</td>
        <td>${record.ts_utc}</td>
        <td><span class="day-badge">${record.day}</span></td>
        <td>${Number(record.latitude).toFixed(4)}¬∞</td>
        <td>${Number(record.longitude).toFixed(4)}¬∞</td>
        <td>${record.altitude !== null ? Number(record.altitude).toFixed(2) + ' km' : '‚Äî'}</td>
      `;
      tbody.appendChild(row);
    });

    document.getElementById('prevDay').disabled = dayIndex === 1;
    document.getElementById('nextDay').disabled = dayIndex === totalDays;

  } catch (err) {
    console.error(err);
    document.getElementById('tableBody').innerHTML =
      '<tr><td colspan="6" class="loading" style="color:#ef4444;">Error loading data</td></tr>';
  }
}

document.getElementById('prevDay').addEventListener('click', () => {
  if (currentDay > 1) {
    currentDay--;
    fetchDataForDay(currentDay);
  }
});

document.getElementById('nextDay').addEventListener('click', () => {
  if (currentDay < totalDays) {
    currentDay++;
    fetchDataForDay(currentDay);
  }
});

// Initial load
fetchDataForDay(currentDay);
</script>
</body>
</html>
