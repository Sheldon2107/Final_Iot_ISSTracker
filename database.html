<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>ISS Database Viewer</title>
<style>
body{font-family:sans-serif;background:#0a0e27;color:#e8eaf6;margin:0;padding:0;}
header{padding:20px;background:rgba(10,14,39,0.9);display:flex;justify-content:space-between;align-items:center;}
header h1{font-size:22px;}
header a{color:#fff;text-decoration:none;background:#667eea;padding:8px 16px;border-radius:8px;}
.container{padding:20px;}
.nav-buttons{display:flex;justify-content:space-between;margin-bottom:20px;}
table{width:100%;border-collapse:collapse;}
th,td{padding:8px;text-align:center;border-bottom:1px solid rgba(232,234,246,0.2);}
th{background:rgba(102,126,234,0.1);}
button{padding:6px 12px;border:none;border-radius:6px;background:#667eea;color:#fff;cursor:pointer;}
button:disabled{background:rgba(102,126,234,0.2);cursor:not-allowed;}
</style>
</head>
<body>
<header>
<h1>ğŸ›°ï¸ ISS Database</h1>
<a href="/">â† Back</a>
</header>
<div class="container">
<div class="nav-buttons">
<button id="prevDay">â† Previous Day</button>
<div><strong id="dayLabel">Day 1</strong></div>
<button id="nextDay">Next Day â†’</button>
</div>
<div style="margin-bottom:10px;">
<button id="downloadDay">ğŸ’¾ Download Day CSV</button>
<button id="downloadAll">ğŸ’¾ Download All CSV</button>
</div>
<table>
<thead>
<tr><th>ID</th><th>Latitude</th><th>Longitude</th><th>Altitude</th><th>Velocity</th><th>Timestamp (MYT)</th></tr>
</thead>
<tbody id="tableBody"></tbody>
</table>
</div>
<script>
let allRecords = [];
let availableDays = [];
let currentDayIndex = 0;

async function fetchRecords(){
  const res = await fetch('/api/all-records');
  const json = await res.json();
  allRecords = json.records || [];
  availableDays = json.available_days || [];
  if(availableDays.length>0) currentDayIndex = availableDays.length-1;
  updateTable();
}

function updateTable(){
  const tbody = document.getElementById('tableBody');
  tbody.innerHTML='';
  if(!availableDays.length) return;
  const day = availableDays[currentDayIndex];
  document.getElementById('dayLabel').textContent = `Day ${currentDayIndex+1} - ${day}`;
  const dayRecords = allRecords.filter(r=>r.day===day);
  dayRecords.forEach(r=>{
    const tr = document.createElement('tr');
    tr.innerHTML=`<td>${r.id}</td><td>${r.latitude}</td><td>${r.longitude}</td><td>${r.altitude}</td><td>${r.velocity}</td><td>${r.ts_myt}</td>`;
    tbody.appendChild(tr);
  });
  document.getElementById('prevDay').disabled = currentDayIndex===0;
  document.getElementById('nextDay').disabled = currentDayIndex===availableDays.length-1;
}

document.getElementById('prevDay').addEventListener('click',()=>{currentDayIndex--; updateTable();});
document.getElementById('nextDay').addEventListener('click',()=>{currentDayIndex++; updateTable();});
document.getElementById('downloadDay').addEventListener('click',()=>{
  if(!availableDays.length) return;
  const day = availableDays[currentDayIndex];
  const dayRecords = allRecords.filter(r=>r.day===day);
  let csv = 'ID,Latitude,Longitude,Altitude,Velocity,Timestamp(MYT)\n';
  dayRecords.forEach(r=>{csv+=`${r.id},${r.latitude},${r.longitude},${r.altitude},${r.velocity},${r.ts_myt}\n`;});
  const blob = new Blob([csv],{type:'text/csv'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download=`ISS_Day${currentDayIndex+1}.csv`; a.click();
});
document.getElementById('downloadAll').addEventListener('click',()=>{window.location='/api/download';});

fetchRecords();
</script>
</body>
</html>
